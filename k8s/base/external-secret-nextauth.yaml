# ExternalSecret for NextAuth credentials
# Syncs secrets from GCP Secret Manager to k8s secret
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: nextauth-credentials
  namespace: threads
spec:
  # Refresh interval - sync from GCP SM every hour
  refreshInterval: 1h

  # Reference to ClusterSecretStore
  secretStoreRef:
    kind: ClusterSecretStore
    name: gcpsm-secret-store

  # Target k8s secret to create/update
  target:
    name: nextauth-secret
    creationPolicy: Owner # ESO owns this secret

  # Map GCP secrets to k8s secret keys
  data:
    # AUTH_SECRET for NextAuth
    - secretKey: secret
      remoteRef:
        key: nextauth-secret

    # Alice user password (SHA1 hash)
    - secretKey: alice_password
      remoteRef:
        key: alice-password

    # Bob user password (SHA1 hash)
    - secretKey: bob_password
      remoteRef:
        key: bob-password
